<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oniguruma-To-ES REPL</title>
  <link href="demo.css" rel="stylesheet">
</head>
<body>
  <main>
    <h1>
      Oniguruma-To-ES
      <a href="https://github.com/slevithan/oniguruma-to-es">
        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c2/GitHub_Invertocat_Logo.svg" width="25" height="25" alt="GitHub">
      </a>
    </h1>
    <p>This is a basic REPL for testing the output of <a href="https://github.com/slevithan/oniguruma-to-es">Oniguruma-To-ES</a>, an Oniguruma to JavaScript RegExp transpiler. See <a href="https://github.com/kkos/oniguruma/blob/master/doc/RE">Oniguruma syntax</a>.</p>

    <h2>Try it</h2>
    <p><textarea id="input" spellcheck="false" oninput="showOutput(this); autoGrow(this)"></textarea></p>
    <p>
      <b class="label">Flags:</b>
      <label>
        <input type="checkbox" id="flag-i" onchange="setFlagI(this.checked)">
        <code>i</code>
      </label>
      <label>
        <input type="checkbox" id="flag-m" onchange="setFlagM(this.checked)">
        <code>m</code> <small>(JS flag <code>s</code>)</small>
      </label>
      <label>
        <input type="checkbox" id="flag-x" onchange="setFlagX(this.checked)">
        <code>x</code>
      </label>
    </p>
    <p>
      <b class="label"><code>target</code>:</b>
      <select id="option-target" onchange="setOptionTarget(this.value)">
        <option value="ES2018">ES2018</option>
        <option value="ES2024" selected>ES2024</option>
        <option value="ESNext">ESNext</option>
      </select>
    </p>
    <details>
      <summary>More options</summary>
      <p>
        <label>
          <input type="checkbox" id="option-allow-best-effort" checked onchange="setOptionAllowBestEffort(this.checked)">
          <code>allowBestEffort</code>
        </label>
        <label>
          <input type="checkbox" id="option-optimize" checked onchange="setOptionOptimize(this.checked)">
          <code>optimize</code>
        </label>
        <label>
          <input type="number" id="option-max-recursion-depth" value="6" min="2" max="100" onchange="setOptionMaxRecursionDepth(this.value)" onkeyup="setOptionMaxRecursionDepth(this.value)">
          <code>maxRecursionDepth</code>
        </label>
      </p>
    </details>
    <pre id="output"></pre>
    <p><small>The output shows the result of calling <code>toRegExp</code>. Oniguruma-To-ES includes functions to generate additional formats: <code>compile</code>, <code>toOnigurumaAst</code>, and <code>toRegexAst</code> (for an AST based on <a href="https://github.com/slevithan/regex"><code>regex</code></a>). You can run all of these from the console on this page. <code>compile</code> and <code>toRegExp</code> accept a <code>pattern</code> string, optional <code>flags</code> string, and optional <code>options</code> object. <code>toOnigurumaAst</code> and <code>toRegexAst</code> accept a <code>pattern</code> and optional <code>flags</code>. You can also pass AST results to <code>printAst</code>.</small></p>
  </main>

  <script src="../dist/index.min.js"></script>
  <script>
    Object.assign(globalThis, OnigurumaToES);
    // For testing in the console
    function printAst(ast) {
      if (ast?.type !== 'Regex') {
        throw new Error('Oniguruma or `regex` AST expected');
      }
      const isObject = value => ({}).toString.call(value) === '[object Object]';
      const nodeIds = new Map();
      let counter = 0;
      console.log(JSON.stringify(ast, function (key, value) {
        if (isObject(this) && !nodeIds.get(this) && key !== '') {
          nodeIds.set(this, ++counter);
        }
        if (key === 'type') {
          return `${value} [ID:${nodeIds.get(this)}]`;
        }
        if (key === 'parent') {
          let parentId = null;
          if (isObject(value)) {
            if (!nodeIds.has(value)) {
              nodeIds.set(value, ++counter);
            }
            parentId = nodeIds.get(value);
          }
          return value ? `[${value.type}:${parentId}]` : value;
        }
        if (key === 'max' && value === Infinity) {
          return '[Infinity]';
        }
        return value;
      }, 'â”‚ '));
    }
  </script>
  <script src="./demo.js"></script>
</body>
</html>
